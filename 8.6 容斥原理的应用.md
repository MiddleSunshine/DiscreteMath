# 8.6 容斥原理的应用

先说一种写法：
$$
首先 P_i 代表一个性质，N(P_i)代表集合中具有该性质的一个元素。\\
|A_1 \cap A_2 \cap A_3 \cdots A_i |=N(P_1 P_2 P_3 \cdots P_i) 代表同时具有集合A_1,A_2,A_3 \cdots A_i形式的元素，\\
或者说N(P_i)是这些集合的交集中的一个元素\\
N(P_1\prime P_2 \prime P_3 \prime \cdots P_i \prime)=N-|A_1 \cup A_2 \cup A_3 \cdots A_i|\\
N代表总数，或者说全集。N(P_1\prime P_2 \prime P_3 \prime \cdots P_i \prime)代表不具有A_1,A_2\cdots A_i集合任何性质的元素，按照之前的容斥原理\\
N(P_1\prime P_2 \prime P_3 \prime \cdots P_i \prime)=N-\sum_{1 \leq i \leq n}N(P_i)+\sum_{1 \leq i<j \leq n}N(P_iP_j)-\sum_{1 \leq i < j < k \leq n}N(P_iP_jP_k)+\cdots +(-1)^n N(P_1P_2P_3 \cdots P_n)
$$
[上面的公式来自容斥原理](https://blog.csdn.net/YQXLLWY/article/details/113206294)

例子：
$$
x_1+x_2+x_3=11,x_1,x_2,x_3 \geq 0。\\
问，当x_1 \leq 3,x_2 \leq 4,x_3 \leq 6，解有多少？
$$
解：
$$
总数有 C(13,2)=78
$$
[C(m,n)的写法来自组合](https://blog.csdn.net/YQXLLWY/article/details/112342301)。这里的总数怎么理解呢？看下图：

![](https://tva1.sinaimg.cn/large/008eGmZEgy1gn3su5f00gj30jz05ft8k.jpg)

第一张图中，其中绿色的代表x的值，白色的代表我们可以切割的地点。因为x都是大于等于0的，但是至少有1个x不为0，才能使总数为11，所以左侧有两个连续的插入点，代表x1,x2都为0的情况。

在上面的基础之上，第二个代表了x1=0,x2=6,x3=5。所以所有的总数为C(13,2)=78.

接下来就是：
$$
令\\
P_1=x_1 > 3\\
P_2=x_2 > 4\\
P_3=x_3 > 6\\
N(P_1)=x_1 >3 \equiv x_1 \geq 4=C(9,2)\\
N(P_2)=C(8,2) \\
N(P_3)=C(6,2)
$$
![](https://tva1.sinaimg.cn/large/008eGmZEgy1gn3t44ibccj30jx052t8k.jpg)

这里解释一下`N(P1)`的情况，为了保证其中一个值一定大于等于4，所以我们就从原先的队列中剔除4个，等到排列结束后，将其加还给x1，这样就可以保证x1一定大于等于4了。

比如上面的第二张图，乍一看结果是x1=0,x2=6,x3=1，但是x1还需要加上预分配给它的4个，于是结果就是x1=4,x2=6,x3=1。

其他的P2,P3也是一样的思路。

接下来就是
$$
N(P_1P_2)=C(4,2)\\
N(P_1P_3)=1，这个很容易理解，如果x_1>3,x_3>6，那么只有1种组合，x_1=4,x_2=0,x_3=7\\
N(P_2P_3)=0，这个同理，这种情况下根本没有解
$$
下面说一下N(P1P2)的值的来源：

![](https://tva1.sinaimg.cn/large/008eGmZEgy1gn3tobr7l9j30jk04ymx0.jpg)

首先，因为确定x1,x2都大于0，所以开头的那两个白格子消失。

接下来就是去除掉预留个x1和x2的总共7个格子。所以按照第二张图中所展示的，x1=1,x2=3,x3=0，加上预留值之后：x1=4,x2=7,x3=0。

最后就是一个最容易理解的
$$
N(P_1P_2P_3)=0
$$
因为不可能存在这样的组合。

在求的上面的值之后，下面才是开始求我们一开始提出的问题：
$$
N(P_1 \prime P_2 \prime P_3 \prime)=N-N(P_1)-N(P_2)-N(P_3)+N(P_1P_2)+N(P_1P_3)+N(P_2P_3)-N(P_1P_2P_3)=6
$$

### 埃拉托斯特尼筛法原理

[埃拉托斯特尼筛法 详细内容见这里](https://blog.csdn.net/YQXLLWY/article/details/111502648)

没讲容斥原理之前，这个内容很容易理解，现在就是用容斥的原理说明一下。
$$
设N是不超过100的数的总数：N=99\\
下面需要求不超过100的素数，根据上面超链接中的定理可知，所有数都可以写作一个或者多个素数的乘积。\\
所以令\\
P_1=(n \mod 2 =0)\\
P_2=(n \mod 3 =0)\\
P_3=(n \mod 5 =0)\\
P_4=(n \mod 7 =0)\\
所以\\
N(P_1 \prime P_2 \prime P_3 \prime P_4 \prime)=N-N(P_1)-N(P_2)-N(P_3)-N(P_4)+N(P_1P_2)+N(P_1P_3)+N(P_2P_3)-N(P_1P_2P_3)+4
$$
最后加4是因为2，3，4，7这4个数本身也是素数，在上面的计算中会被忽略掉。

#### 映上函数个数

[映上函数定义：简单来说就是集合B中的每个元素都有一个对应的集合A的元素](https://blog.csdn.net/YQXLLWY/article/details/111305452)

想要理解这玩意，需要在完全理解映上函数的基础之上。

**这个我感觉书上的例子有问题，所以下面的计算方式和书上不一样**

例子：6元素集合到3元素集合，有多少映上函数？
$$
N=3^6，这个总数代表一定有\\
令3元素集合为(b_1,b_2,b_3)\\
P_1=(3集合中b_1元素没有映上函数) \\
P_2=(3集合中b_2元素没有映上函数) \\
P_3=(3集合中b_3元素没有映上函数) \\
N(P_1 \prime P_2 \prime P_3 \prime)=N-N(P_1)-N(P_2)-N(P_3)+N(P_1P_2)+N(P_1P_3)+N(P_2P_3)-N(P_1P_2P_3)\\
=3^6-2^6-2^6-2^6+1+1+1-0=540
$$
这里解释一下上面的值的来源：
$$
N(P_1) 代表 b_1 没有映射函数，所以6元素集合都对应到剩下的2个元素上，比如下面的图片中展示的。
$$
![](https://tva1.sinaimg.cn/large/008eGmZEgy1gn4xg0909hj308z0eidg0.jpg)

这样的情况下，总共能使用的组合数为`2^6`。
$$
然后再说明 N(P_1P_2)，那么情况只有1种，6元素都对应到b_3上去。\\
至于 N(P_1P_2P_3) 则是0，因为我们最开始设置总数 3^6 的时候就是6元素一定要有对应的值。
$$

----------

在上面的基础之上，考虑一个问题，真的需要拆分出`b1,b2,b3`吗？其实`b1,b2,b3`的选择可以使用组合的方式来考虑吧，比如将上面的计算函数写成下面的形式：
$$
3^6-C(3,1)N(P_i)+C(3,2)N(P_iP_j)-C(3,3)N(P_iP_jP_k)\\
N(P_i)代表b_i元素没有映上函数，这样的元素有 C(3,1)种\\
N(P_iP_j)代表b_i,b_j元素没有映上函数，这样的元素有C(3,2)种
$$
上面是3个元素，如果拓展一下，m元素集合到n元素集合时，`m>=n`，映上函数的数量为：
$$
n^m-C(n,1)(n-1)^m+C(n,2)(n-2)^m- \cdots +(-1)^n C(n,n-1)\cdot 1^m
$$
